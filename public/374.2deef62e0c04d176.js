"use strict";(self.webpackChunktestCloud=self.webpackChunktestCloud||[]).push([[374],{6374:(Q,d,n)=>{n.r(d),n.d(d,{UsuariosModule:()=>O});var p=n(9808),c=n(3333),u=n(8390),i=n(2382),o=n(7587),g=n(520),m=n(2340);let f=(()=>{class r{constructor(t){this.http=t,localStorage.getItem("token")}get httpOptions(){return{headers:(new g.WM).set("x-token",localStorage.getItem("token")||""),responseType:"json"}}getUsuarios(t=1){return this.http.get(m.N.baseUrl+"usuarios?page="+t,this.httpOptions)}getUsuario(t){return this.http.get(m.N.baseUrl+"usuarios/"+t,this.httpOptions)}saveUsuario(t){return this.http.post(m.N.baseUrl+"usuarios",t,this.httpOptions)}deleteUsuario(t){return this.http.delete(m.N.baseUrl+"usuarios/"+t,this.httpOptions)}}return r.\u0275fac=function(t){return new(t||r)(o.LFG(g.eN))},r.\u0275prov=o.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var v=n(2290),_=n(1424),h=n(845);function T(r,s){if(1&r&&(o.TgZ(0,"small",16),o._uU(1),o.qZA()),2&r){const t=o.oxw();o.xp6(1),o.Oqu(t.getErrorMsg("usuario"))}}function x(r,s){if(1&r&&(o.TgZ(0,"small",16),o._uU(1),o.qZA()),2&r){const t=o.oxw();o.xp6(1),o.Oqu(t.getErrorMsg("nombre"))}}function A(r,s){if(1&r&&(o.TgZ(0,"small",16),o._uU(1),o.qZA()),2&r){const t=o.oxw();o.xp6(1),o.Oqu(t.getErrorMsg("apellido"))}}function b(r,s){if(1&r&&(o.TgZ(0,"small",16),o._uU(1),o.qZA()),2&r){const t=o.oxw();o.xp6(1),o.Oqu(t.getErrorMsg("correo"))}}function q(r,s){if(1&r){const t=o.EpF();o.TgZ(0,"div"),o.TgZ(1,"button",17),o.NdJ("click",function(){return o.CHM(t),o.oxw().deleteUser()}),o.qZA(),o.qZA()}if(2&r){const t=o.oxw();o.xp6(1),o.Q6J("loading",t.loading)}}function C(r,s){if(1&r){const t=o.EpF();o.TgZ(0,"div"),o.TgZ(1,"button",18),o.NdJ("click",function(){return o.CHM(t),o.oxw().clearForm()}),o.qZA(),o.qZA()}if(2&r){const t=o.oxw();o.xp6(1),o.Q6J("disabled",t.loading)}}function F(r,s){if(1&r){const t=o.EpF();o.TgZ(0,"div"),o.TgZ(1,"button",19),o.NdJ("click",function(){return o.CHM(t),o.oxw().save()}),o.qZA(),o.qZA()}if(2&r){const t=o.oxw();o.xp6(1),o.Q6J("loading",t.loading)}}let U=(()=>{class r{constructor(t,e,a,l){this.router=t,this.fb=e,this.srvUsuarios=a,this.toastr=l,this.loading=!1,this.formUsuario=this.fb.group({_id:[""],usuario:["",[i.kI.required,i.kI.minLength(3),i.kI.pattern("(?!.*[.-_]{2,})^[a-zA-Z0-9.-_]{3,24}$")]],nombre:["",[i.kI.required,i.kI.minLength(3)]],apellido:["",[i.kI.required,i.kI.minLength(3)]],correo:["",[i.kI.required,i.kI.email]]})}get title(){return"/usuarios/form"===this.router.url?"Crear Usuario":"Detalle Usuario"}ngOnInit(){const t=parseInt(this.router.url.split("/")[3]);t&&this.getUser(t)}clearForm(){this.formUsuario.reset()}getUser(t){this.loading=!0,this.srvUsuarios.getUsuario(t).subscribe({next:e=>{this.formUsuario.patchValue(e),this.formUsuario.disable(),this.loading=!1},error:e=>{console.log(e),this.loading=!1,this.toastr.error("Error al obtener usuario"),this.router.navigate(["/usuarios/list"])},complete:()=>console.log("complete")})}save(){this.ajustarForm(),console.log(this.formUsuario.value),this.formUsuario.valid?(console.log("Formulario valido"),this.loading=!0,this.srvUsuarios.saveUsuario(this.formUsuario.value).subscribe({next:t=>{console.log(t),this.toastr.success("Usuario agregado correctamente"),this.router.navigate(["/usuarios/list"]),this.loading=!1},error:t=>{if(console.log(t),t.error){const{message:e,code:a}=t.error;1===a&&this.formUsuario.get("correo").setErrors({inuse:!0}),2===a&&this.formUsuario.get("usuario").setErrors({inuse:!0}),this.formUsuario.markAsTouched(),this.toastr.error(e)}else this.toastr.error("Error al agregar usuario");this.loading=!1},complete:()=>{console.log("complete")}})):(this.formUsuario.markAllAsTouched(),this.toastr.error("Errores en el formulario","Error"))}campoValido(t){return this.formUsuario.controls[t].errors&&(this.formUsuario.controls[t].dirty||this.formUsuario.controls[t].touched)}getErrorMsg(t){var e;const a=null===(e=this.formUsuario.get(t))||void 0===e?void 0:e.errors;if(a){const{required:l,minlength:Z,email:E,inuse:Y,pattern:z}=a;if(l)return"Campo requerido";if(Z)return"Minimo 3 caracteres";if(E)return"Email incorrecto";if(Y)return"Ya se encuentra registrado";if(z)return"No cumple con el patron de usuario"}return""}deleteUser(){if(confirm("\xbfEsta seguro de eliminar el usuario?")){const e=this.formUsuario.get("_id").value;this.loading=!0,this.srvUsuarios.deleteUsuario(e).subscribe({next:()=>{this.toastr.success("Usuario eliminado correctamente"),this.router.navigate(["/usuarios/list"]),this.loading=!1},error:a=>{console.log(a),this.toastr.error("Error al eliminar usuario"),this.loading=!1},complete:()=>console.log("complete")})}}ajustarForm(){this.formUsuario.patchValue({usuario:this.normalize(this.formUsuario.get("usuario").value),nombre:this.normalize(this.formUsuario.get("nombre").value),apellido:this.normalize(this.formUsuario.get("apellido").value),correo:this.normalize(this.formUsuario.get("correo").value)})}normalize(t){var e;return null===(e=t.trim())||void 0===e?void 0:e.toUpperCase()}goback(){this.router.navigate(["/usuarios/list"])}}return r.\u0275fac=function(t){return new(t||r)(o.Y36(c.F0),o.Y36(i.qu),o.Y36(f),o.Y36(v._W))},r.\u0275cmp=o.Xpm({type:r,selectors:[["app-form-usuarios"]],decls:32,vars:10,consts:[[1,"container"],[3,"formGroup"],[1,"formgrid","grid"],[1,"field","col-6","sm:col-12","md:col-6"],["for","usuario"],["id","usuario","type","text","pInputText","","formControlName","usuario","placeholder","Sin espacios",1,"inputfield","w-full"],["id","username2-help","class","p-error",4,"ngIf"],["for","nombre"],["id","nombre","type","text","pInputText","","formControlName","nombre","placeholder","Nombres",1,"inputfield","w-full"],["for","apellido"],["id","apellido","type","text","pInputText","","formControlName","apellido","placeholder","Apellidos",1,"inputfield","w-full"],["for","correo"],["id","correo","type","text","pInputText","","formControlName","correo","placeholder","micorreo@ejemplo.com",1,"inputfield","w-full"],[1,"flex","justify-content-end","align-content-center"],["pButton","","type","button","label","Volver",1,"p-button-warning","mr-3",3,"disabled","click"],[4,"ngIf"],["id","username2-help",1,"p-error"],["pButton","","type","button","label","Eliminar",1,"p-button-danger",3,"loading","click"],["pButton","","type","button","label","Limpiar",1,"p-button-danger","mr-3",3,"disabled","click"],["pButton","","type","button","label","Guardar",1,"p-button-info",3,"loading","click"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"h1"),o._uU(2),o.qZA(),o.TgZ(3,"form",1),o.TgZ(4,"div",2),o.TgZ(5,"div",3),o.TgZ(6,"label",4),o._uU(7,"Usuario"),o.qZA(),o._UZ(8,"input",5),o.YNc(9,T,2,1,"small",6),o.qZA(),o.TgZ(10,"div",3),o.TgZ(11,"label",7),o._uU(12,"Nombre"),o.qZA(),o._UZ(13,"input",8),o.YNc(14,x,2,1,"small",6),o.qZA(),o.qZA(),o.TgZ(15,"div",2),o.TgZ(16,"div",3),o.TgZ(17,"label",9),o._uU(18,"Apellido"),o.qZA(),o._UZ(19,"input",10),o.YNc(20,A,2,1,"small",6),o.qZA(),o.TgZ(21,"div",3),o.TgZ(22,"label",11),o._uU(23,"Correo"),o.qZA(),o._UZ(24,"input",12),o.YNc(25,b,2,1,"small",6),o.qZA(),o.qZA(),o.TgZ(26,"div",13),o.TgZ(27,"div"),o.TgZ(28,"button",14),o.NdJ("click",function(){return e.goback()}),o.qZA(),o.qZA(),o.YNc(29,q,2,1,"div",15),o.YNc(30,C,2,1,"div",15),o.YNc(31,F,2,1,"div",15),o.qZA(),o.qZA(),o.qZA()),2&t&&(o.xp6(2),o.Oqu(e.title),o.xp6(1),o.Q6J("formGroup",e.formUsuario),o.xp6(6),o.Q6J("ngIf",e.campoValido("usuario")),o.xp6(5),o.Q6J("ngIf",e.campoValido("nombre")),o.xp6(6),o.Q6J("ngIf",e.campoValido("apellido")),o.xp6(5),o.Q6J("ngIf",e.campoValido("correo")),o.xp6(3),o.Q6J("disabled",e.loading),o.xp6(1),o.Q6J("ngIf",e.formUsuario.value._id),o.xp6(1),o.Q6J("ngIf",!e.formUsuario.value._id),o.xp6(1),o.Q6J("ngIf",!e.formUsuario.value._id))},directives:[i._Y,i.JL,i.sg,i.Fj,_.o,i.JJ,i.u,p.O5,h.Hq],styles:[""]}),r})();var I=n(1087),k=n(9783);function y(r,s){1&r&&(o.TgZ(0,"tr"),o.TgZ(1,"th"),o._uU(2,"Id"),o.qZA(),o.TgZ(3,"th"),o._uU(4,"Usuario"),o.qZA(),o.TgZ(5,"th"),o._uU(6,"Nombre"),o.qZA(),o.TgZ(7,"th"),o._uU(8,"Apellido"),o.qZA(),o.TgZ(9,"th"),o._uU(10,"Correo"),o.qZA(),o.qZA())}function N(r,s){if(1&r){const t=o.EpF();o.TgZ(0,"tr",7),o.NdJ("click",function(){const l=o.CHM(t).$implicit;return o.oxw().gotoDetail(l)}),o.TgZ(1,"td"),o._uU(2),o.qZA(),o.TgZ(3,"td"),o._uU(4),o.ALo(5,"titlecase"),o.qZA(),o.TgZ(6,"td"),o._uU(7),o.ALo(8,"titlecase"),o.qZA(),o.TgZ(9,"td"),o._uU(10),o.ALo(11,"titlecase"),o.qZA(),o.TgZ(12,"td"),o._uU(13),o.ALo(14,"titlecase"),o.qZA(),o.qZA()}if(2&r){const t=s.$implicit;o.xp6(2),o.Oqu(t._id),o.xp6(2),o.Oqu(o.lcZ(5,5,t.usuario)),o.xp6(3),o.Oqu(o.lcZ(8,7,t.nombre)),o.xp6(3),o.Oqu(o.lcZ(11,9,t.apellido)),o.xp6(3),o.Oqu(o.lcZ(14,11,t.correo))}}const J=[{path:"",children:[{path:"lista",component:(()=>{class r{constructor(t,e){this.srvUsuarios=t,this.router=e,this.usuarios=[]}ngOnInit(){this.getUsuarios(1)}getUsuarios(t){this.srvUsuarios.getUsuarios(t).subscribe({next:e=>{console.log(e),this.usuarios=e.usuarios},error:e=>console.log(e),complete:()=>console.log("complete")})}gotoForm(){this.router.navigate(["/usuarios/form"])}gotoDetail(t){this.router.navigate(["/usuarios/form/"+t._id])}}return r.\u0275fac=function(t){return new(t||r)(o.Y36(f),o.Y36(c.F0))},r.\u0275cmp=o.Xpm({type:r,selectors:[["app-list-usuarios"]],decls:10,vars:1,consts:[[1,"container"],[1,"flex","justify-content-between","align-content-center"],[1,"flex","align-items-center","justify-content-center"],["pButton","","type","button","label","Agregar",1,"p-button-info",3,"click"],["responsiveLayout","scroll",3,"value"],["pTemplate","header"],["pTemplate","body"],[1,"seleccionable",3,"click"]],template:function(t,e){1&t&&(o.TgZ(0,"div",0),o.TgZ(1,"div",1),o.TgZ(2,"div"),o.TgZ(3,"h1"),o._uU(4,"Lista de usuarios"),o.qZA(),o.qZA(),o.TgZ(5,"div",2),o.TgZ(6,"button",3),o.NdJ("click",function(){return e.gotoForm()}),o.qZA(),o.qZA(),o.qZA(),o.TgZ(7,"p-table",4),o.YNc(8,y,11,0,"ng-template",5),o.YNc(9,N,15,13,"ng-template",6),o.qZA(),o.qZA()),2&t&&(o.xp6(7),o.Q6J("value",e.usuarios))},directives:[h.Hq,I.iA,k.jx],pipes:[p.rS],styles:[".seleccionable[_ngcontent-%COMP%]{cursor:pointer}.seleccionable[_ngcontent-%COMP%]:hover{background-color:#e5f1f7}"]}),r})(),canActivate:[u.z],canLoad:[u.z]},{path:"form",component:U,canActivate:[u.z],canLoad:[u.z]},{path:"form/:id",component:U,canActivate:[u.z],canLoad:[u.z]},{path:"**",redirectTo:"lista"}]}];let L=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=o.oAB({type:r}),r.\u0275inj=o.cJS({imports:[[c.Bz.forChild(J)],c.Bz]}),r})();var M=n(2765);let O=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=o.oAB({type:r}),r.\u0275inj=o.cJS({imports:[[p.ez,L,M.W,i.UX]]}),r})()}}]);